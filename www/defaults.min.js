/*!  CyTube Enhancements: Room Defaults
**|  Version: 2024.09.16
**@preserve
*/ "use strict";if(void 0===CBE)var CBE={};if(void 0===UPDATE_CSS)var UPDATE_CSS=!0;if(void 0===UPDATE_EMOTES)var UPDATE_EMOTES=!0;if(void 0===UPDATE_FILTERS)var UPDATE_FILTERS=!0;if(void 0===UPDATE_JS)var UPDATE_JS=!0;if(void 0===UPDATE_MOTD)var UPDATE_MOTD=!0;if(void 0===UPDATE_OPTIONS)var UPDATE_OPTIONS=!0;if(void 0===UPDATE_PERMISSIONS)var UPDATE_PERMISSIONS=!0;const BlockerCSS_URL=Base_URL+"blocker.css",Emotes_URL=Root_URL+"emoji/emoji.json",JS_URL=Room_URL+"JS_Editor.js",MOTD_URL=Room_URL+"motd.html";CBE.getEmotes=function(){jQuery.getJSON(Emotes_URL,function(t){logTrace("defaults.getEmotes",t),window.socket.emit("importEmotes",t)}).fail(function(t){errorData("defaults.getEmotes Error",t.status+": "+t.statusText)})},CBE.getMOTD=function(){jQuery.ajax({url:MOTD_URL,datatype:"html",cache:!1,error:function(t){errorData("defaults.getMOTD Error",t.status+": "+t.statusText)},success:function(t){logTrace("defaults.getMOTD",t),window.socket.emit("setMotd",{motd:t})}}),setMOTDmessage()},CBE.getBot=function(){window.socket.once("channelRanks",function(t){let e=-1;jQuery.each(t,function(t,s){s.name.toLowerCase()===BOT_NICK.toLowerCase()&&(e=s.rank)}),window.CLIENT.rank>window.Rank.Admin&&e<window.Rank.Admin&&window.socket.emit("setChannelRank",{name:BOT_NICK,rank:window.Rank.Admin})}),window.socket.emit("requestChannelRanks")},CBE.getCSS=function(){let t="",e="";function s(){if(AGE_RESTRICT&&t.length<1||e.length<1)return;let s=e;AGE_RESTRICT&&(s+=t),logTrace("defaults.getCSS.setCustomCSS",s),window.socket.emit("setChannelCSS",{css:s})}AGE_RESTRICT&&jQuery.ajax({url:BlockerCSS_URL,datatype:"text",async:!1,cache:!1,error:function(t){errorData("defaults.getBlockerCSS Error",t.status+": "+t.statusText)},success:function(e){logTrace("defaults.getBlockerCSS",e),t=e,s()}}),jQuery.ajax({url:CustomCSS_URL,datatype:"text",async:!1,cache:!1,error:function(t){errorData("defaults.getCustomCSS Error",t.status+": "+t.statusText)},success:function(t){logTrace("defaults.getCustomCSS",t),e=t,s()}})},CBE.getJavascript=function(){jQuery.ajax({url:JS_URL,datatype:"script",async:!1,cache:!1,crossDomain:!0,error:function(t){errorData("defaults.getJavascript Error",t.status+": "+t.statusText)},success:function(t){t!==CHANNEL.js&&(logTrace("defaults.getJavascript",t),window.socket.emit("setChannelJS",{js:t}),setTimeout(function(){errorData("defaults.getJavascript","RELOAD"),location.reload(!0)},1e4))}})},CBE.getFilters=function(){let t=[Base_URL+"filters.json",Room_URL+"filters.json",],e=0,s=[],n=[];for(let o=0;o<t.length;o++)n.push(jQuery.ajax({url:t[o],datatype:"json",timeout:500,cache:!1}));function i(n){if(s.push(n),++e<t.length)return;let o=[];s.forEach(function(t){o=o.concat(t.filter(t=>!JSON.stringify(o).includes(JSON.stringify(t))))}),logTrace("defaults.getFilters",JSON.stringify(o)),window.socket.emit("importFilters",o)}jQuery.when(n).always(function(){jQuery.each(n,function(t){this.done(function(t){i(t)}).fail(function(t){i([])})})})},CBE.getSettings=function(t,e){let s=[],n,o,i=Base_URL+t+".json",a=Room_URL+t+".json";function r(s){if(s.responseJSON||(s.responseJSON={}),s.order<1?n=s.responseJSON:o=s.responseJSON,n&&o){let i={...n,...o};logTrace("defaults.getSettings."+t,JSON.stringify(i)),window.socket.emit(e,i)}}s.push(jQuery.ajax({url:i,datatype:"json",timeout:500,cache:!1,beforeSend:function(t){t.order=0}})),s.push(jQuery.ajax({url:a,datatype:"json",timeout:500,cache:!1,beforeSend:function(t){t.order=1}})),jQuery.when(s).always(function(){jQuery.each(s,function(t,e){this.success(function(t,e,s){r(s)}).fail(function(t,e){r(t)})})})},CBE.getOptions=function(){CBE.getSettings("options","setOptions")},CBE.getPermissions=function(){CBE.getSettings("permissions","setPermissions")},$(document).ready(function(){CBE.getBot(),UPDATE_JS&&CBE.getJavascript(),UPDATE_CSS&&CBE.getCSS(),UPDATE_MOTD&&CBE.getMOTD(),UPDATE_EMOTES&&CBE.getEmotes(),UPDATE_FILTERS&&CBE.getFilters(),UPDATE_OPTIONS&&CBE.getOptions(),UPDATE_PERMISSIONS&&CBE.getPermissions()});