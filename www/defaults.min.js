/*!  CyTube Enhancements: Room Defaults
**|  Version: 2024.09.21
**@preserve
*/ "use strict";if("undefined"!=typeof CBE&&CBE||console.warn("defaults.CBE Missing"),void 0===UPDATE_JS)var UPDATE_JS=!1;if(void 0===UPDATE_CSS)var UPDATE_CSS=!0;if(void 0===UPDATE_EMOTES)var UPDATE_EMOTES=!0;if(void 0===UPDATE_FILTERS)var UPDATE_FILTERS=!0;if(void 0===UPDATE_MOTD)var UPDATE_MOTD=!0;if(void 0===UPDATE_OPTIONS)var UPDATE_OPTIONS=!0;if(void 0===UPDATE_PERMISSIONS)var UPDATE_PERMISSIONS=!0;const BlockerCSS_URL=CBE.Base_URL+"blocker.css",Emotes_URL=CBE.Root_URL+"emoji/emoji.json",JS_URL=CBE.Room_URL+"JS_Editor.js",MOTD_URL=CBE.Room_URL+"motd.html";CBE.getEmotes=function(){jQuery.getJSON(Emotes_URL,function(t){CBE.traceLog("defaults.getEmotes",t),window.socket.emit("importEmotes",t)}).fail(function(t){CBE.errorData("defaults.getEmotes Error",t.status+": "+t.statusText)})},CBE.getMOTD=function(){jQuery.ajax({url:MOTD_URL,datatype:"html",cache:!1,error:function(t){CBE.errorData("defaults.getMOTD Error",t.status+": "+t.statusText)},success:function(t){CBE.traceLog("defaults.getMOTD",t),window.socket.emit("setMotd",{motd:t})}}),CBE.setMOTDmessage()},CBE.getBot=function(){window.socket.once("channelRanks",function(t){let e=-1;jQuery.each(t,function(t,s){s.name.toLowerCase()===BOT_NICK.toLowerCase()&&(e=s.rank)}),window.CLIENT.rank>window.Rank.Admin&&e<window.Rank.Admin&&window.socket.emit("setChannelRank",{name:BOT_NICK,rank:window.Rank.Admin})}),window.socket.emit("requestChannelRanks")},CBE.getCSS=function(){let t="",e="";function s(){if(AGE_RESTRICT&&t.length<1||e.length<1)return;let s=e;AGE_RESTRICT&&(s+=t),CBE.traceLog("defaults.getCSS.setCustomCSS",s),window.socket.emit("setChannelCSS",{css:s})}AGE_RESTRICT&&jQuery.ajax({url:BlockerCSS_URL,datatype:"text",async:!1,cache:!1,error:function(t){CBE.errorData("defaults.getBlockerCSS Error",t.status+": "+t.statusText)},success:function(e){CBE.traceLog("defaults.getBlockerCSS",e),t=e,s()}}),jQuery.ajax({url:CBE.CustomCSS_URL,datatype:"text",async:!1,cache:!1,error:function(t){CBE.errorData("defaults.getCustomCSS Error",t.status+": "+t.statusText)},success:function(t){CBE.traceLog("defaults.getCustomCSS",t),e=t,s()}})},CBE.getJavascript=function(){jQuery.ajax({url:JS_URL,datatype:"script",async:!1,cache:!1,crossDomain:!0,error:function(t){CBE.errorData("defaults.getJavascript Error",t.status+": "+t.statusText)},success:function(t){t!==CHANNEL.js&&(CBE.traceLog("defaults.getJavascript",t),window.socket.emit("setChannelJS",{js:t}),setTimeout(function(){CBE.errorData("defaults.getJavascript","RELOAD"),location.reload(!0)},1e4))}})},CBE.getFilters=function(){let t=[CBE.Base_URL+"filters.json",CBE.Room_URL+"filters.json",],e=0,s=[],o=[];for(let n=0;n<t.length;n++)o.push(jQuery.ajax({url:t[n],datatype:"json",timeout:500,cache:!1}));function a(o){if(s.push(o),++e<t.length)return;let n=[];s.forEach(function(t){n=n.concat(t.filter(t=>!JSON.stringify(n).includes(JSON.stringify(t))))}),CBE.traceLog("defaults.getFilters",JSON.stringify(n)),window.socket.emit("importFilters",n)}jQuery.when(o).always(function(){jQuery.each(o,function(t){this.done(function(t){a(t)}).fail(function(t){a([])})})})},CBE.getSettings=function(t,e){let s=[],o,n,a=CBE.Base_URL+t+".json",r=CBE.Room_URL+t+".json";function i(s){if(s.responseJSON||(s.responseJSON={}),s.order<1?o=s.responseJSON:n=s.responseJSON,o&&n){let a={...o,...n};CBE.traceLog("defaults.getSettings."+t,JSON.stringify(a)),window.socket.emit(e,a)}}s.push(jQuery.ajax({url:a,datatype:"json",timeout:500,cache:!1,beforeSend:function(t){t.order=0}})),s.push(jQuery.ajax({url:r,datatype:"json",timeout:500,cache:!1,beforeSend:function(t){t.order=1}})),jQuery.when(s).always(function(){jQuery.each(s,function(t,e){this.success(function(t,e,s){i(s)}).fail(function(t,e){i(t)})})})},CBE.getOptions=function(){CBE.getSettings("options","setOptions")},CBE.getPermissions=function(){CBE.getSettings("permissions","setPermissions")},CBE.delayChanges=function(){CBE.debugData("defaults.document.ready"),CBE.getBot(),UPDATE_JS&&CBE.getJavascript(),UPDATE_CSS&&CBE.getCSS(),UPDATE_MOTD&&CBE.getMOTD(),UPDATE_OPTIONS&&CBE.getOptions(),UPDATE_PERMISSIONS&&CBE.getPermissions(),UPDATE_EMOTES&&CBE.getEmotes(),UPDATE_FILTERS&&CBE.getFilters()},jQuery(document).ready(function(){try{setTimeout(function(){CBE.delayChanges()},2500)}catch(t){window.console.error("defaults.load error",t)}});